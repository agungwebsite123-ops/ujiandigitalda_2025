<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Portal Ujian Siswa - Daarul Amiin IBS</title>
  <meta name="description" content="Aplikasi ujian online untuk siswa SMP dan SMA Daarul Amiin IBS - Install sebagai aplikasi mobile">
  <meta name="theme-color" content="#2563eb"><!-- iOS Safari Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Portal Ujian">
  <meta name="format-detection" content="telephone=no"><!-- Android Chrome Meta Tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Portal Ujian"><!-- PWA Manifest -->
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUG9ydGFsIFVqaWFuIFNpc3dhIC0gRGFhcnVsIEFtaWluIElCUyIsInNob3J0X25hbWUiOiJQb3J0YWwgVWppYW4iLCJkZXNjcmlwdGlvbiI6IkFwbGlrYXNpIHVqaWFuIG9ubGluZSB1bnR1ayBzaXN3YSBTTVA7IGRhbiBTTUEgRGFhcnVsIEFtaWluIElCUyIsInN0YXJ0X3VybCI6Ii4vIiwiaWQiOiJwb3J0YWwtdWppYW4tZGFhcnVsLWFtaWluIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJvcmllbnRhdGlvbiI6InBvcnRyYWl0IiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZmZmZmYiLCJ0aGVtZV9jb2xvciI6IiMyNTYzZWIiLCJjYXRlZ29yaWVzIjpbImVkdWNhdGlvbiIsInByb2R1Y3Rpdml0eSJdLCJsYW5nIjoiaWQiLCJzY29wZSI6Ii4vIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1USTRJaUJvWldsbmFIUTlJakV5T0NJaVlYaHBjejBpTUNBd0lERXlPQ0F4TWpnaUlIWnBaWGRDYjNnOUlqQWdNQ0F4TWpnZ01USTRJaUJtYVd4c1BTSWlNalUyTTJWaUlpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaVBqeHlaV04wSUhkcFpIUm9QU0l4TWpnaUlHaGxhV2RvZEQwaU1USTRJaUJtYVd4c1BTSWlNalUyTTJWaUlpOCtQSFJsZUhRZ2VEMGlOalFpSUhrOUlqWTBJaUJtYVd4c1BTSWlabVptWm1abUlpQm1iMjUwTFhOcGVtVTlJalE0SWlCbWIyNTBMWGRsYVdkb2REMGlZbTlzWkNJK09EK1F1end2ZEdWNGRENDhMM04yWno0PSIsInNpemVzIjoiMTI4eDEyOCIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn0seyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlOVEV5SWlCb1pXbG5hSFE5SWpVeE1pSWlZWGhwY3owaU1DQXdJRFV4TWlBMU1USWlJSFpwWlhkQ2IzZzlJakFnTUNBMU1USWdOVEV5SWlCbWFXeHNQU0lpTWpVMk0yVmlJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lQanh5WldOMElIZHBaSFJvUFNJMU1USWlJR2hsYVdkb2REMGlOVEV5SWlCbWFXeHNQU0lpTWpVMk0yVmlJaTgrUEhSbGVIUWdlRDBpTVRJNElpQjVQU0l4TWpnaUlHWnBiR3c5SWlabVptWm1abVlpSUdadmJuUXRjMmw2WlQwaU9EQWlJR1p2Ym5RdGQyVnBaMmgwUFNJaVltOXNaQ0krT0QrUXV6d3ZkR1Y0ZEQ0OEwzTjJaejQ9Iiwic2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV0sInNjcmVlbnNob3RzIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlOekF3SWlCb1pXbG5hSFE5SWpFeU1EQWlJSFpwWlhkQ2IzZzlJakFnTUNBM01EQWdNVEl3TUNJaVptbHNiRDBpSXpBd01EQm1aaUlnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JajQ4Y21WamRDQjNhV1IwYUQwaU56QXdJaUJvWldsbmFIUTlJakV5TURBaUlHWnBiR3c5SWlNd01EQkdSaUl2UGp4MFpYaDBJSGc5SWpNMU1DSWdlVDBpTmpBd0lpQm1hV3hzUFNJaU1qVTJNMlZpSWlCbWIyNTBMWE5wZW1VOUlqTXdJaUJtYjI1MExYZGxhV2RvZEQwaVltOXNaQ0krVUc5eWRHRnNJRlZxYVdGdVBDOTBaWGgwUGp4MFpYaDBJSGc5SWpNMU1DSWdlVDBpTmpVd0lpQm1hV3hzUFNJaU5EWTBOalEySWlCbWIyNTBMWE5wZW1VOUlqSXdJaUJtYjI1MExYZGxhV2RvZEQwaWJtOXliV0ZzSWo1RVlXRnlkV3dnUVcxcGFXNGdTVUpUUEM5MFpYaDBQand2YzNabkBqND0iLCJzaXplcyI6IjcwMHgxMjAwIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV0sInNob3J0Y3V0cyI6W3sibmFtZSI6IkxvZ2luIFNpc3dhIiwidXJsIjoiLi8iLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRJNElpQm9aV2xuYUhROUlqRXlPQ0lpSUhacFpYZENiM2c5SWpBZ01DQXhNamdnTVRJNElpQm1hV3hzUFNJaU1qVTJNMlZpSWlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpUGp4eVpXTjBJSGRwWkhSb1BTSXhNamdpSUdobGFXZG9kRDBpTVRJNElpQm1hV3hzUFNJaU1qVTJNMlZpSWk4K1BIUmxlSFFnZUQwaU5qUWlJSGs5SWpZMElpQm1hV3hzUFNJaVptWm1abVptSWlCbWIyNTBMWE5wZW1VOUlqUTRJaUJtYjI1MExYZGxhV2RvZEQwaVltOXNaQ0krOEorUXV6d3ZkR1Y0ZEQ0OEwzTjJaejQ9Iiwic2l6ZXMiOiIxMjh4MTI4In1dfV0sInByZWZlcl9yZWxhdGVkX2FwcGxpY2F0aW9ucyI6ZmFsc2UsImRpc3BsYXlfb3ZlcnJpZGUiOnsibmF2aWdhdGlvbiI6dHJ1ZX19"><!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIGZpbGw9IiMyNTYzZWIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEyOCIgaGVpZ2h0PSIxMjgiIGZpbGw9IiMyNTYzZWIiLz48dGV4dCB4PSI2NCIgeT0iNjQiIGZpbGw9IiNmZmZmZmYiIGZvbnQtc2l6ZT0iNDgiIGZvbnQtd2VpZ2h0PSJib2xkIj7wn5C7PC90ZXh0Pjwvc3ZnPg==">
  <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9IiMyNTYzZWIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxODAiIGZpbGw9IiMyNTYzZWIiLz48dGV4dCB4PSI5MCIgeT0iOTAiIGZpbGw9IiNmZmZmZmYiIGZvbnQtc2l6ZT0iNjQiIGZvbnQtd2VpZ2h0PSJib2xkIj7wn5C7PC90ZXh0Pjwvc3ZnPg==">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: none;
            position: relative;
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }
        
        html {
            height: -webkit-fill-available;
        }
        
        input, textarea, select {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
            -webkit-touch-callout: default;
            font-size: 16px !important;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 8px;
        }
        
        button {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Mobile-specific styles */
        @media (max-width: 768px) {
            .mobile-padding {
                padding-left: 16px !important;
                padding-right: 16px !important;
            }
            
            .mobile-text-sm {
                font-size: 14px !important;
            }
            
            .mobile-spacing {
                margin-bottom: 12px !important;
            }
        }
        
        /* iOS Safari specific fixes */
        @supports (-webkit-touch-callout: none) {
            .ios-safe-area {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
            }
        }
        
        .timer-warning {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Fullscreen iframe styles */
        .exam-iframe {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            border: none;
            z-index: 9999;
            background: white;
        }
        
        /* Timer overlay */
        .timer-overlay {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-family: monospace;
            font-weight: bold;
            z-index: 10000;
            font-size: 14px;
        }
        
        /* Exit button overlay */
        .exit-overlay {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(75, 85, 99, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            z-index: 10000;
            font-size: 12px;
            cursor: pointer;
            touch-action: manipulation;
        }
        
        .exit-overlay:hover, .exit-overlay:active {
            background: rgba(239, 68, 68, 0.9);
        }
        
        /* Mobile timer adjustments */
        @media (max-width: 768px) {
            .timer-overlay {
                top: env(safe-area-inset-top, 10px);
                right: env(safe-area-inset-right, 10px);
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .exit-overlay {
                top: env(safe-area-inset-top, 10px);
                left: env(safe-area-inset-left, 10px);
                padding: 6px 12px;
                font-size: 10px;
            }
        }
        
        /* Prevent zoom on double tap */
        .no-zoom {
            touch-action: manipulation;
        }
        
        /* Mobile security styles */
        .exam-locked {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
            overflow: hidden !important;
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            -webkit-touch-callout: none !important;
            -webkit-tap-highlight-color: transparent !important;
            overscroll-behavior: none !important;
            -webkit-overflow-scrolling: touch !important;
        }
        
        /* Disable text selection during exam */
        .exam-active * {
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            -webkit-touch-callout: none !important;
        }
        
        /* Allow text selection only in Google Form iframe */
        .exam-active iframe {
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
            user-select: text !important;
            -webkit-touch-callout: default !important;
        }
        
        /* Block edge swipe gestures */
        .exam-active {
            overscroll-behavior-x: none !important;
            overscroll-behavior-y: none !important;
            -webkit-overscroll-behavior: none !important;
            -ms-overscroll-behavior: none !important;
            overscroll-behavior: none !important;
        }
        
        /* Prevent pull-to-refresh */
        .exam-active body {
            overscroll-behavior: none !important;
            -webkit-overscroll-behavior: none !important;
            -ms-overscroll-behavior: none !important;
        }
        
        /* Hide scrollbars during exam */
        .exam-active::-webkit-scrollbar {
            display: none !important;
        }
        
        .exam-active {
            -ms-overflow-style: none !important;
            scrollbar-width: none !important;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen ios-safe-area no-zoom"><!-- Login Page -->
  <div id="loginPage" class="min-h-screen flex items-center justify-center p-4 mobile-padding">
   <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 w-full max-w-md">
    <div class="text-center mb-6 md:mb-8">
     <div class="bg-blue-600 w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-3 md:mb-4"><span class="text-white text-xl md:text-2xl font-bold">📚</span>
     </div>
     <h1 class="text-xl md:text-2xl font-bold text-gray-800">Portal Ujian Siswa</h1>
     <p class="text-gray-600 mt-2 text-sm md:text-base">Daarul Amiin IBS</p>
    </div><!-- Install App Notification on Login Page -->
    <div id="loginInstallNotification" class="bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-xl p-4 mb-6 shadow-lg">
     <div class="text-center">
      <div class="text-2xl mb-2">
       📱✨
      </div>
      <h4 class="font-bold text-sm md:text-base mb-2">INSTALL APLIKASI PORTAL UJIAN</h4>
      <p class="text-xs md:text-sm mb-3 opacity-90">Ujian Google Form akan dibuka di dalam aplikasi ini, bukan di browser Chrome!</p>
      <div class="bg-white bg-opacity-20 rounded-lg p-3 mb-3">
       <p class="text-xs font-medium mb-1">🎯 KEUNGGULAN APLIKASI:</p>
       <ul class="text-xs space-y-1 text-left">
        <li>✅ Google Form terbuka di dalam aplikasi</li>
        <li>✅ Tidak perlu buka Chrome browser</li>
        <li>✅ Keamanan ujian lebih maksimal</li>
        <li>✅ Akses langsung dari home screen</li>
       </ul>
      </div>
      <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2"><button id="loginInstallBtn" class="flex-1 bg-white text-green-600 px-4 py-2 rounded-lg hover:bg-gray-100 active:bg-gray-200 transition duration-200 text-xs md:text-sm font-medium no-zoom"> 📱 Install Aplikasi </button> <button id="loginDismissBtn" class="flex-1 bg-transparent border border-white text-white px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 active:bg-white active:bg-opacity-30 transition duration-200 text-xs md:text-sm no-zoom"> Nanti Saja </button>
      </div>
     </div>
    </div>
    <form id="loginForm" class="space-y-4 md:space-y-6">
     <div><label for="studentName" class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label> <input type="text" id="studentName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent no-zoom" placeholder="Masukkan nama lengkap" autocomplete="name" inputmode="text">
     </div>
     <div><label for="studentLevel" class="block text-sm font-medium text-gray-700 mb-2">Jenjang</label> <select id="studentLevel" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent no-zoom"> <option value="">Pilih Jenjang</option> <option value="SMP">SMP</option> <option value="SMA">SMA</option> </select>
     </div>
     <div><label for="studentClass" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label> <select id="studentClass" required disabled class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 no-zoom"> <option value="">Pilih jenjang terlebih dahulu</option> </select>
     </div><button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 active:bg-blue-800 transition duration-200 font-medium no-zoom"> Masuk ke Portal Ujian </button>
    </form>
   </div>
  </div><!-- Main Dashboard -->
  <div id="dashboardPage" class="hidden min-h-screen"><!-- Header -->
   <header class="bg-white shadow-sm border-b ios-safe-area">
    <div class="max-w-6xl mx-auto px-4 py-3 mobile-padding">
     <div class="flex justify-between items-center">
      <div class="flex items-center space-x-2 md:space-x-3">
       <div class="bg-blue-600 w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center"><span class="text-white font-bold text-sm md:text-base">📚</span>
       </div>
       <div>
        <h1 class="text-base md:text-xl font-bold text-gray-800">Portal Ujian</h1>
        <p class="text-xs md:text-sm text-gray-600" id="welcomeText">Selamat datang</p>
       </div>
      </div>
      <div class="flex items-center space-x-2 md:space-x-4"><!-- Install App Button (PWA) --> <button id="installBtn" class="bg-green-500 text-white px-3 md:px-4 py-2 rounded-lg hover:bg-green-600 active:bg-green-700 transition duration-200 text-xs md:text-base no-zoom"> 📱 Install Aplikasi </button> <button id="logoutBtn" class="bg-red-500 text-white px-3 md:px-4 py-2 rounded-lg hover:bg-red-600 active:bg-red-700 transition duration-200 text-xs md:text-base no-zoom"> Logout </button>
      </div>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="max-w-6xl mx-auto px-4 py-4 md:py-8 mobile-padding">
    <div class="bg-white rounded-2xl shadow-lg p-4 md:p-8">
     <div class="text-center mb-6 md:mb-8">
      <h2 class="text-lg md:text-2xl font-bold text-gray-800 mb-2">Daftar Mata Pelajaran Ujian</h2>
      <p class="text-sm md:text-base text-gray-600">Pilih mata pelajaran yang akan diujikan hari ini</p>
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 md:p-4 mt-4 mobile-spacing">
       <p class="text-yellow-800 font-medium text-xs md:text-sm mobile-text-sm">⚠️ Penting: Setiap ujian hanya dapat diakses SATU KALI dan berlangsung selama 90 menit</p>
      </div><!-- Exam Schedule Info -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 md:p-4 mt-4 mobile-spacing">
       <h4 class="text-blue-800 font-medium text-sm md:text-base mb-2">📅 Jadwal Ujian Hari Ini</h4>
       <div id="examSchedule" class="text-blue-700 text-xs md:text-sm mobile-text-sm"><!-- Schedule will be populated by JavaScript -->
       </div>
      </div><!-- Simple Info -->
      <div class="bg-green-50 border border-green-200 rounded-lg p-3 md:p-4 mt-4 mobile-spacing">
       <h4 class="text-green-800 font-medium text-sm md:text-base mb-2">📝 CARA MENGERJAKAN</h4>
       <div class="text-green-700 text-xs md:text-sm mobile-text-sm">
        <p class="mb-1 md:mb-2">✅ Klik mata pelajaran yang ingin dikerjakan</p>
        <p class="mb-1 md:mb-2">✅ Google Form akan terbuka di dalam aplikasi ini</p>
        <p class="mb-1 md:mb-2">✅ Kerjakan soal dengan tenang</p>
        <p>✅ Klik "Keluar Ujian" jika sudah selesai</p>
       </div>
      </div>
     </div>
     <div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 md:gap-6" id="subjectList"><!-- Subjects will be populated by JavaScript -->
     </div>
    </div>
   </main>
  </div><!-- Exam Modal -->
  <div id="examModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 mobile-padding">
   <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 w-full max-w-md max-h-screen overflow-y-auto">
    <div class="text-center">
     <div class="bg-blue-100 w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-3 md:mb-4"><span class="text-blue-600 text-xl md:text-2xl">📝</span>
     </div>
     <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4" id="modalTitle">Konfirmasi Ujian</h3>
     <p class="text-gray-600 mb-4 md:mb-6 text-sm md:text-base" id="modalMessage">Anda akan memulai ujian dan timer 90 menit akan dimulai.</p>
     <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 md:p-4 mb-3 md:mb-4">
      <p class="text-blue-800 text-sm font-medium">📋 PETUNJUK UJIAN:</p>
      <ul class="text-blue-700 text-xs mt-2 space-y-1 text-left">
       <li>• Google Form akan terbuka di dalam aplikasi ini</li>
       <li>• Timer 90 menit akan berjalan di pojok kanan atas</li>
       <li>• Klik "Keluar Ujian" jika sudah selesai</li>
       <li>• Pastikan jawaban sudah di-submit di Google Form</li>
      </ul>
     </div>
     <div class="bg-red-50 border border-red-200 rounded-lg p-3 md:p-4 mb-4 md:mb-6">
      <p class="text-red-800 text-sm font-medium">🚨 PERINGATAN KEAMANAN:</p>
      <ul class="text-red-700 text-xs mt-2 space-y-1 text-left">
       <li>• JANGAN buka aplikasi lain selama ujian</li>
       <li>• JANGAN pindah tab browser</li>
       <li>• Maksimal 2 pelanggaran, ujian akan DIHENTIKAN</li>
       <li>• Ujian yang dihentikan TIDAK DAPAT DIULANG</li>
      </ul>
     </div>
     <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4"><button id="cancelExam" class="flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 active:bg-gray-500 transition duration-200 no-zoom"> Batal </button> <button id="startExam" class="flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 active:bg-blue-800 transition duration-200 no-zoom"> Mulai Ujian </button>
     </div>
    </div>
   </div>
  </div><!-- Install App Modal -->
  <div id="installModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 mobile-padding">
   <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 w-full max-w-md max-h-screen overflow-y-auto">
    <div class="text-center">
     <div class="bg-green-100 w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-3 md:mb-4"><span class="text-green-600 text-xl md:text-2xl">📱</span>
     </div>
     <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">Install Aplikasi Portal Ujian</h3>
     <p class="text-gray-600 mb-4 md:mb-6 text-sm md:text-base">Install Portal Ujian sebagai aplikasi mobile untuk pengalaman ujian yang lebih baik!</p>
     <div class="bg-green-50 border border-green-200 rounded-lg p-3 md:p-4 mb-3 md:mb-4">
      <p class="text-green-800 text-sm font-medium mb-2">🎯 KEUNGGULAN APLIKASI MOBILE:</p>
      <ul class="text-green-700 text-xs space-y-1 text-left">
       <li>📝 Google Form terbuka di dalam aplikasi</li>
       <li>🚫 Tidak perlu buka browser Chrome</li>
       <li>🔒 Keamanan ujian lebih maksimal</li>
       <li>📱 Akses langsung dari home screen</li>
       <li>⚡ Loading lebih cepat dan stabil</li>
       <li>💾 Hemat data dengan cache</li>
      </ul>
     </div>
     <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 md:p-4 mb-4 md:mb-6">
      <p class="text-blue-800 text-sm font-medium mb-2">📋 CARA INSTALL:</p>
      <ul class="text-blue-700 text-xs space-y-1 text-left">
       <li>1️⃣ Klik tombol "Install App" di bawah</li>
       <li>2️⃣ Browser akan menampilkan popup install</li>
       <li>3️⃣ Klik "Install" atau "Tambahkan"</li>
       <li>4️⃣ Aplikasi akan muncul di home screen</li>
      </ul>
     </div>
     <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4"><button id="cancelInstall" class="flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 active:bg-gray-500 transition duration-200 no-zoom"> Nanti Saja </button> <button id="confirmInstall" class="flex-1 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 active:bg-green-800 transition duration-200 no-zoom"> 📱 Install Aplikasi </button>
     </div>
    </div>
   </div>
  </div><!-- Fullscreen Exam Container -->
  <div id="examContainer" class="hidden"><!-- Timer Overlay -->
   <div id="timerOverlay" class="timer-overlay"><span id="timeLeft">90:00</span>
   </div><!-- Exit Button Overlay -->
   <div id="exitOverlay" class="exit-overlay"><span>Keluar Ujian</span>
   </div><!-- Google Form Iframe --> <iframe id="examIframe" class="exam-iframe" src="" allowfullscreen></iframe>
  </div>
  <script>
        // Link Google Form berdasarkan kelas
        const formUrlsByClass = {
            // SMP Classes
            'VII': {
                'ipa': 'https://forms.gle/ipa-kelas7',
                'ips': 'https://forms.gle/ips-kelas7',
                'matematika': 'https://forms.gle/matematika-kelas7',
                'bahasa-indonesia': 'https://forms.gle/bahasa-indonesia-kelas7',
                'bahasa-inggris': 'https://forms.gle/bahasa-inggris-kelas7',
                'bahasa-arab': 'https://forms.gle/bahasa-arab-kelas7',
                'pjok': 'https://forms.gle/pjok-kelas7',
                'bimbingan-konseling': 'https://forms.gle/bk-kelas7',
                'informatika': 'https://forms.gle/WLkD1MDKqT3Esdv9A',
                'nahwu-sharaf': 'https://forms.gle/nahwu-sharaf-kelas7',
                'aqidah': 'https://forms.gle/aqidah-kelas7',
                'fiqih': 'https://forms.gle/fiqih-kelas7',
                'qurdis': 'https://forms.gle/qurdis-kelas7'
            },
            'VIII': {
                'ipa': 'https://forms.gle/ipa-kelas8',
                'ips': 'https://forms.gle/ips-kelas8',
                'matematika': 'https://forms.gle/matematika-kelas8',
                'bahasa-indonesia': 'https://forms.gle/bahasa-indonesia-kelas8',
                'bahasa-inggris': 'https://forms.gle/bahasa-inggris-kelas8',
                'bahasa-arab': 'https://forms.gle/bahasa-arab-kelas8',
                'pjok': 'https://forms.gle/pjok-kelas8',
                'bimbingan-konseling': 'https://forms.gle/bk-kelas8',
                'informatika': 'https://forms.gle/WLkD1MDKqT3Esdv9A',
                'nahwu-sharaf': 'https://forms.gle/nahwu-sharaf-kelas8',
                'aqidah': 'https://forms.gle/aqidah-kelas8',
                'fiqih': 'https://forms.gle/fiqih-kelas8',
                'qurdis': 'https://forms.gle/qurdis-kelas8'
            },
            'IX': {
                'ipa': 'https://forms.gle/ipa-kelas9',
                'ips': 'https://forms.gle/ips-kelas9',
                'matematika': 'https://forms.gle/matematika-kelas9',
                'bahasa-indonesia': 'https://forms.gle/bahasa-indonesia-kelas9',
                'bahasa-inggris': 'https://forms.gle/bahasa-inggris-kelas9',
                'bahasa-arab': 'https://forms.gle/bahasa-arab-kelas9',
                'pjok': 'https://forms.gle/pjok-kelas9',
                'bimbingan-konseling': 'https://forms.gle/bk-kelas9',
                'informatika': 'https://forms.gle/WLkD1MDKqT3Esdv9A',
                'nahwu-sharaf': 'https://forms.gle/nahwu-sharaf-kelas9',
                'aqidah': 'https://forms.gle/aqidah-kelas9',
                'fiqih': 'https://forms.gle/fiqih-kelas9',
                'qurdis': 'https://forms.gle/qurdis-kelas9'
            },
            // SMA Classes
            'X': {
                'nahwu-sharaf': 'https://forms.gle/nahwu-sharaf-kelas10',
                'quran-hadist': 'https://forms.gle/quran-hadist-kelas10',
                'aqidah-akhlak': 'https://forms.gle/aqidah-akhlak-kelas10',
                'spi': 'https://forms.gle/spi-kelas10',
                'fiqih': 'https://forms.gle/fiqih-kelas10',
                'bahasa-arab': 'https://forms.gle/bahasa-arab-kelas10',
                'bahasa-indonesia': 'https://forms.gle/bahasa-indonesia-kelas10',
                'bahasa-inggris': 'https://forms.gle/bahasa-inggris-kelas10',
                'ipa-terpadu': 'https://forms.gle/ipa-terpadu-kelas10',
                'fisika': 'https://forms.gle/fisika-kelas10',
                'kimia': 'https://forms.gle/kimia-kelas10',
                'biologi': 'https://forms.gle/biologi-kelas10',
                'matematika': 'https://forms.gle/matematika-kelas10',
                'ips': 'https://forms.gle/ips-kelas10',
                'informatika': 'https://forms.gle/informatika-kelas10',
                'pjok': 'https://forms.gle/pjok-kelas10',
                'bimbingan-konseling': 'https://forms.gle/bk-kelas10'
            },
            'XI': {
                'nahwu-sharaf': 'https://forms.gle/nahwu-sharaf-kelas11',
                'quran-hadist': 'https://forms.gle/quran-hadist-kelas11',
                'aqidah-akhlak': 'https://forms.gle/aqidah-akhlak-kelas11',
                'spi': 'https://forms.gle/spi-kelas11',
                'fiqih': 'https://forms.gle/fiqih-kelas11',
                'bahasa-arab': 'https://forms.gle/bahasa-arab-kelas11',
                'bahasa-indonesia': 'https://forms.gle/bahasa-indonesia-kelas11',
                'bahasa-inggris': 'https://forms.gle/bahasa-inggris-kelas11',
                'ipa-terpadu': 'https://forms.gle/ipa-terpadu-kelas11',
                'fisika': 'https://forms.gle/fisika-kelas11',
                'kimia': 'https://forms.gle/kimia-kelas11',
                'biologi': 'https://forms.gle/biologi-kelas11',
                'matematika': 'https://forms.gle/matematika-kelas11',
                'ips': 'https://forms.gle/ips-kelas11',
                'informatika': 'https://forms.gle/informatika-kelas11',
                'pjok': 'https://forms.gle/pjok-kelas11',
                'bimbingan-konseling': 'https://forms.gle/bk-kelas11'
            },
            'XII': {
                'nahwu-sharaf': 'https://forms.gle/nahwu-sharaf-kelas12',
                'quran-hadist': 'https://forms.gle/quran-hadist-kelas12',
                'aqidah-akhlak': 'https://forms.gle/aqidah-akhlak-kelas12',
                'spi': 'https://forms.gle/spi-kelas12',
                'fiqih': 'https://forms.gle/fiqih-kelas12',
                'bahasa-arab': 'https://forms.gle/bahasa-arab-kelas12',
                'bahasa-indonesia': 'https://forms.gle/bahasa-indonesia-kelas12',
                'bahasa-inggris': 'https://forms.gle/bahasa-inggris-kelas12',
                'ipa-terpadu': 'https://forms.gle/ipa-terpadu-kelas12',
                'fisika': 'https://forms.gle/fisika-kelas12',
                'kimia': 'https://forms.gle/kimia-kelas12',
                'biologi': 'https://forms.gle/biologi-kelas12',
                'matematika': 'https://forms.gle/matematika-kelas12',
                'ips': 'https://forms.gle/ips-kelas12',
                'informatika': 'https://forms.gle/informatika-kelas12',
                'pjok': 'https://forms.gle/pjok-kelas12',
                'bimbingan-konseling': 'https://forms.gle/bk-kelas12'
            }
        };

        // Mata pelajaran berdasarkan jenjang
        const subjectsBySMP = [
            { id: 'ipa', name: 'IPA', icon: '🔬', color: 'bg-red-500' },
            { id: 'ips', name: 'IPS', icon: '🌏', color: 'bg-orange-500' },
            { id: 'matematika', name: 'Matematika', icon: '🔢', color: 'bg-blue-500' },
            { id: 'bahasa-indonesia', name: 'Bahasa Indonesia', icon: '📖', color: 'bg-green-500' },
            { id: 'bahasa-inggris', name: 'Bahasa Inggris', icon: '🌍', color: 'bg-purple-500' },
            { id: 'bahasa-arab', name: 'Bahasa Arab', icon: '📜', color: 'bg-amber-500' },
            { id: 'pjok', name: 'PJOK', icon: '⚽', color: 'bg-cyan-500' },
            { id: 'bimbingan-konseling', name: 'Bimbingan Konseling', icon: '🧠', color: 'bg-indigo-500' },
            { id: 'informatika', name: 'Informatika', icon: '💻', color: 'bg-slate-600' },
            { id: 'nahwu-sharaf', name: 'Nahwu Sharaf', icon: '📚', color: 'bg-teal-600' },
            { id: 'aqidah', name: 'Aqidah', icon: '🕌', color: 'bg-emerald-600' },
            { id: 'fiqih', name: 'Fiqih', icon: '📖', color: 'bg-green-600' },
            { id: 'qurdis', name: 'Qurdis', icon: '📿', color: 'bg-purple-600' }
        ];

        const subjectsBySMA = [
            { id: 'nahwu-sharaf', name: 'Nahwu Sharaf', icon: '📚', color: 'bg-teal-600' },
            { id: 'quran-hadist', name: 'Qur\'an Hadist', icon: '📿', color: 'bg-purple-600' },
            { id: 'aqidah-akhlak', name: 'Aqidah Akhlak', icon: '🕌', color: 'bg-emerald-600' },
            { id: 'spi', name: 'Sejarah Peradaban Islam (SPI)', icon: '🏛️', color: 'bg-orange-600' },
            { id: 'fiqih', name: 'Fiqih', icon: '📖', color: 'bg-green-600' },
            { id: 'bahasa-arab', name: 'Bahasa Arab', icon: '📜', color: 'bg-amber-500' },
            { id: 'bahasa-indonesia', name: 'Bahasa Indonesia', icon: '📖', color: 'bg-green-500' },
            { id: 'bahasa-inggris', name: 'Bahasa Inggris', icon: '🌍', color: 'bg-purple-500' },
            { id: 'ipa-terpadu', name: 'IPA Terpadu', icon: '🔬', color: 'bg-red-500' },
            { id: 'fisika', name: 'Fisika', icon: '⚛️', color: 'bg-red-600' },
            { id: 'kimia', name: 'Kimia', icon: '🧪', color: 'bg-yellow-500' },
            { id: 'biologi', name: 'Biologi', icon: '🌱', color: 'bg-emerald-500' },
            { id: 'matematika', name: 'Matematika', icon: '🔢', color: 'bg-blue-500' },
            { id: 'ips', name: 'IPS', icon: '🌏', color: 'bg-orange-500' },
            { id: 'informatika', name: 'Informatika', icon: '💻', color: 'bg-blue-600' },
            { id: 'pjok', name: 'PJOK', icon: '⚽', color: 'bg-cyan-500' },
            { id: 'bimbingan-konseling', name: 'Bimbingan Konseling', icon: '🧠', color: 'bg-indigo-500' }
        ];

        // Jadwal ujian hari ini
        const todayExamSchedule = {
            SMP: ['informatika', 'matematika', 'bahasa-indonesia'],
            SMA: ['nahwu-sharaf', 'matematika', 'fisika']
        };

        let currentStudent = null;
        let examTimer = null;
        let timeRemaining = 90 * 60; // 90 minutes in seconds
        let currentExamSubject = null;
        let isExamActive = false;

        // PWA Install functionality
        let deferredPrompt;
        let isInstallPromptShown = false;

        // Get completed exams from localStorage
        function getCompletedExams() {
            const completed = localStorage.getItem('completedExams');
            return completed ? JSON.parse(completed) : {};
        }

        // Mark exam as completed
        function markExamCompleted(studentKey, subjectId) {
            const completed = getCompletedExams();
            if (!completed[studentKey]) {
                completed[studentKey] = [];
            }
            completed[studentKey].push(subjectId);
            localStorage.setItem('completedExams', JSON.stringify(completed));
        }

        // Check if exam is completed
        function isExamCompleted(studentKey, subjectId) {
            const completed = getCompletedExams();
            return completed[studentKey] && completed[studentKey].includes(subjectId);
        }

        // Get subjects based on level
        function getSubjectsByLevel(level) {
            return level === 'SMP' ? subjectsBySMP : subjectsBySMA;
        }

        // Get form URL based on class and subject
        function getFormUrl(studentClass, subjectId) {
            const grade = studentClass.replace(/[AB]$/, '');
            
            if (formUrlsByClass[grade] && formUrlsByClass[grade][subjectId]) {
                return formUrlsByClass[grade][subjectId];
            }
            
            return `https://forms.gle/sample-${subjectId}-${grade.toLowerCase()}`;
        }

        // Check if subject is scheduled for today
        function isSubjectScheduledToday(level, subjectId) {
            return todayExamSchedule[level] && todayExamSchedule[level].includes(subjectId);
        }

        // Update class options based on selected level
        document.getElementById('studentLevel').addEventListener('change', function() {
            const level = this.value;
            const classSelect = document.getElementById('studentClass');
            
            classSelect.innerHTML = '<option value="">Pilih Kelas</option>';
            
            if (level === 'SMP') {
                ['A', 'B'].forEach(section => {
                    const option = document.createElement('option');
                    option.value = `VII${section}`;
                    option.textContent = `VII ${section}`;
                    classSelect.appendChild(option);
                });
                
                ['A', 'B', 'C'].forEach(section => {
                    const option = document.createElement('option');
                    option.value = `VIII${section}`;
                    option.textContent = `VIII ${section}`;
                    classSelect.appendChild(option);
                });
                
                ['A', 'B'].forEach(section => {
                    const option = document.createElement('option');
                    option.value = `IX${section}`;
                    option.textContent = `IX ${section}`;
                    classSelect.appendChild(option);
                });
                
                classSelect.disabled = false;
            } else if (level === 'SMA') {
                ['X', 'XI', 'XII'].forEach(grade => {
                    ['A', 'B'].forEach(section => {
                        const option = document.createElement('option');
                        option.value = `${grade}${section}`;
                        option.textContent = `${grade} ${section}`;
                        classSelect.appendChild(option);
                    });
                });
                classSelect.disabled = false;
            } else {
                classSelect.disabled = true;
            }
        });

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('studentName').value.trim();
            const level = document.getElementById('studentLevel').value;
            const studentClass = document.getElementById('studentClass').value;
            
            if (name && level && studentClass) {
                currentStudent = {
                    name: name,
                    level: level,
                    class: studentClass,
                    key: `${name}-${level}-${studentClass}`.toLowerCase().replace(/\s+/g, '-')
                };
                
                document.getElementById('welcomeText').textContent = `${name} - ${level} ${studentClass}`;
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('dashboardPage').classList.remove('hidden');
                
                renderSubjects();
                renderExamSchedule();
            }
        });

        // Render exam schedule
        function renderExamSchedule() {
            const scheduleDiv = document.getElementById('examSchedule');
            const todaySubjects = todayExamSchedule[currentStudent.level] || [];
            
            if (todaySubjects.length === 0) {
                scheduleDiv.innerHTML = '<p class="text-blue-600">Tidak ada ujian yang dijadwalkan hari ini.</p>';
            } else {
                const subjects = getSubjectsByLevel(currentStudent.level);
                const scheduledSubjectNames = todaySubjects.map(id => {
                    const subject = subjects.find(s => s.id === id);
                    return subject ? subject.name : id;
                });
                scheduleDiv.innerHTML = `<p class="text-blue-600">Mata pelajaran hari ini: <strong>${scheduledSubjectNames.join(', ')}</strong></p>`;
            }
        }

        // Check if device is mobile
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   window.innerWidth <= 768;
        }

        // Render subjects
        function renderSubjects() {
            const subjectList = document.getElementById('subjectList');
            subjectList.innerHTML = '';
            
            const subjects = getSubjectsByLevel(currentStudent.level);
            const isMobile = isMobileDevice();
            
            subjects.forEach(subject => {
                const isCompleted = isExamCompleted(currentStudent.key, subject.id);
                const isScheduled = isSubjectScheduledToday(currentStudent.level, subject.id);
                
                const subjectCard = document.createElement('div');
                let cardClass, statusBadge, clickable = false;
                
                if (isCompleted) {
                    cardClass = 'border-red-300 bg-red-50 opacity-80';
                    statusBadge = `<span class="inline-block bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium ${isMobile ? 'text-xs' : 'md:text-sm'}">❌ ${isMobile ? 'Selesai' : 'Tidak Dapat Diulang'}</span>`;
                } else if (isScheduled) {
                    cardClass = 'border-blue-300 bg-blue-50 hover:border-blue-400 hover:shadow-lg cursor-pointer active:bg-blue-100';
                    statusBadge = `<span class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium ${isMobile ? 'text-xs' : 'md:text-sm'}">📝 ${isMobile ? 'Siap' : 'Siap Dikerjakan'}</span>`;
                    clickable = true;
                } else {
                    cardClass = 'border-gray-300 bg-gray-100 opacity-50';
                    statusBadge = `<span class="inline-block bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs font-medium ${isMobile ? 'text-xs' : 'md:text-sm'}">🔒 ${isMobile ? 'Terkunci' : 'Tidak Dijadwalkan'}</span>`;
                }
                
                subjectCard.className = `bg-white border-2 rounded-xl p-3 md:p-6 transition duration-200 no-zoom ${cardClass}`;
                
                const iconSize = isMobile ? 'w-10 h-10' : 'w-12 h-12 md:w-16 md:h-16';
                const textSize = isMobile ? 'text-xs' : 'text-sm md:text-lg';
                const iconTextSize = isMobile ? 'text-base' : 'text-lg md:text-2xl';
                
                subjectCard.innerHTML = `
                    <div class="text-center">
                        <div class="${subject.color} ${iconSize} rounded-full flex items-center justify-center mx-auto mb-2 md:mb-4 ${!isScheduled && !isCompleted ? 'opacity-50' : ''}">
                            <span class="text-white ${iconTextSize}">${subject.icon}</span>
                        </div>
                        <h3 class="${textSize} font-bold text-gray-800 mb-2 leading-tight">${subject.name}</h3>
                        ${statusBadge}
                    </div>
                `;
                
                if (clickable) {
                    subjectCard.addEventListener('click', () => showExamModal(subject));
                    subjectCard.addEventListener('touchstart', () => {}, {passive: true});
                }
                
                subjectList.appendChild(subjectCard);
            });
        }

        // Show exam confirmation modal
        function showExamModal(subject) {
            const formUrl = getFormUrl(currentStudent.class, subject.id);
            currentExamSubject = {
                ...subject,
                formUrl: formUrl
            };
            
            document.getElementById('modalTitle').textContent = `Ujian ${subject.name}`;
            document.getElementById('modalMessage').textContent = 
                `Anda akan memulai ujian ${subject.name} untuk kelas ${currentStudent.class}. Timer 90 menit akan dimulai dan Google Form akan terbuka fullscreen.`;
            document.getElementById('examModal').classList.remove('hidden');
        }

        // Cancel exam
        document.getElementById('cancelExam').addEventListener('click', function() {
            document.getElementById('examModal').classList.add('hidden');
            currentExamSubject = null;
        });

        // Start exam
        document.getElementById('startExam').addEventListener('click', function() {
            if (currentExamSubject) {
                // Mark exam as completed immediately
                markExamCompleted(currentStudent.key, currentExamSubject.id);
                
                // Start fullscreen exam
                startFullscreenExam();
                
                // Close modal and refresh subjects
                document.getElementById('examModal').classList.add('hidden');
                renderSubjects();
                
                currentExamSubject = null;
            }
        });

        // Start fullscreen exam
        function startFullscreenExam() {
            isExamActive = true;
            securityViolations = 0; // Reset violation counter
            
            // Request fullscreen mode
            requestFullscreen();
            
            // Hide dashboard and show exam container
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('examContainer').classList.remove('hidden');
            
            // Load Google Form in iframe
            const iframe = document.getElementById('examIframe');
            iframe.src = currentExamSubject.formUrl;
            
            // Start timer
            startExamTimer();
            
            // Setup exit button
            document.getElementById('exitOverlay').addEventListener('click', exitExam);
            
            // Prevent scrolling on body
            document.body.style.overflow = 'hidden';
            
            // Add mobile security classes
            document.body.classList.add('exam-active');
            document.documentElement.classList.add('exam-active');
            document.getElementById('examContainer').classList.add('exam-locked');
            
            // Enable exam security measures
            enableExamSecurity();
        }

        // Request fullscreen mode
        function requestFullscreen() {
            const element = document.documentElement;
            
            // For mobile devices, try different fullscreen methods
            if (isMobileDevice()) {
                // iOS Safari specific
                if (element.webkitRequestFullscreen) {
                    element.webkitRequestFullscreen();
                } else if (element.webkitEnterFullscreen) {
                    element.webkitEnterFullscreen();
                }
                // Android Chrome
                else if (element.requestFullscreen) {
                    element.requestFullscreen();
                }
                // Fallback: hide address bar on mobile
                else {
                    window.scrollTo(0, 1);
                    document.body.style.height = '100vh';
                    document.body.style.overflow = 'hidden';
                }
            } else {
                // Desktop fullscreen
                if (element.requestFullscreen) {
                    element.requestFullscreen();
                } else if (element.mozRequestFullScreen) {
                    element.mozRequestFullScreen();
                } else if (element.webkitRequestFullscreen) {
                    element.webkitRequestFullscreen();
                } else if (element.msRequestFullscreen) {
                    element.msRequestFullscreen();
                }
            }
        }

        // Exit fullscreen mode
        function exitFullscreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }

        // Enable exam security measures
        function enableExamSecurity() {
            // Disable right-click context menu
            document.addEventListener('contextmenu', preventDefaultAction);
            
            // Disable common keyboard shortcuts
            document.addEventListener('keydown', handleExamKeydown);
            
            // Monitor fullscreen changes
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('mozfullscreenchange', handleFullscreenChange);
            document.addEventListener('MSFullscreenChange', handleFullscreenChange);
            
            // Monitor window focus/blur
            window.addEventListener('blur', handleWindowBlur);
            window.addEventListener('focus', handleWindowFocus);
            
            // Monitor visibility changes (tab switching)
            document.addEventListener('visibilitychange', handleVisibilityChange);
            
            // DESKTOP SECURITY: Force fullscreen and disable browser controls
            enableDesktopSecurity();
            
            // MOBILE SECURITY: Block all hardware buttons
            enableMobileHardwareBlock();
            
            // MOBILE SECURITY: Prevent navigation gestures
            enableNavigationBlock();
            
            // MOBILE SECURITY: Lock screen orientation
            lockScreenOrientation();
            
            // MOBILE SECURITY: Disable pull-to-refresh
            disablePullToRefresh();
            
            // MOBILE SECURITY: Block Android back button
            blockAndroidBackButton();
            
            // MOBILE SECURITY: Prevent app switching
            preventAppSwitching();
        }

        // Disable exam security measures
        function disableExamSecurity() {
            document.removeEventListener('contextmenu', preventDefaultAction);
            document.removeEventListener('keydown', handleExamKeydown);
            document.removeEventListener('fullscreenchange', handleFullscreenChange);
            document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.removeEventListener('mozfullscreenchange', handleFullscreenChange);
            document.removeEventListener('MSFullscreenChange', handleFullscreenChange);
            window.removeEventListener('blur', handleWindowBlur);
            window.removeEventListener('focus', handleWindowFocus);
            document.removeEventListener('visibilitychange', handleVisibilityChange);
            
            // DESKTOP SECURITY: Restore desktop functionality
            disableDesktopSecurity();
            
            // MOBILE SECURITY: Restore mobile functionality
            disableMobileHardwareBlock();
            disableNavigationBlock();
            unlockScreenOrientation();
            enablePullToRefresh();
            unblockAndroidBackButton();
            allowAppSwitching();
        }

        // ===== DESKTOP SECURITY FUNCTIONS =====
        
        // Enable desktop security measures
        function enableDesktopSecurity() {
            if (isMobileDevice()) return;
            
            // Force fullscreen mode and prevent exit
            forceFullscreenMode();
            
            // Hide browser UI elements
            hideBrowserUI();
            
            // Disable browser context menus
            disableBrowserContextMenus();
            
            // Monitor window state changes
            monitorWindowState();
            
            // Prevent window minimize/maximize
            preventWindowControls();
        }
        
        function disableDesktopSecurity() {
            if (isMobileDevice()) return;
            
            // Restore normal browser behavior
            restoreNormalMode();
            
            // Show browser UI elements
            showBrowserUI();
            
            // Enable browser context menus
            enableBrowserContextMenus();
            
            // Stop monitoring window state
            stopMonitoringWindowState();
            
            // Allow window controls
            allowWindowControls();
        }
        
        // Force fullscreen mode on desktop
        function forceFullscreenMode() {
            // Request fullscreen with maximum compatibility
            const element = document.documentElement;
            
            if (element.requestFullscreen) {
                element.requestFullscreen({ navigationUI: "hide" });
            } else if (element.mozRequestFullScreen) {
                element.mozRequestFullScreen();
            } else if (element.webkitRequestFullscreen) {
                element.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
            } else if (element.msRequestFullscreen) {
                element.msRequestFullscreen();
            }
            
            // Continuously monitor and re-request fullscreen if exited
            setInterval(() => {
                if (isExamActive && !isInFullscreen()) {
                    requestFullscreen();
                    showFullscreenForceWarning();
                }
            }, 1000);
        }
        
        // Check if currently in fullscreen
        function isInFullscreen() {
            return !!(document.fullscreenElement || 
                     document.webkitFullscreenElement || 
                     document.mozFullScreenElement || 
                     document.msFullscreenElement);
        }
        
        // Hide browser UI elements
        function hideBrowserUI() {
            // Add CSS to hide browser chrome
            const hideUIStyle = document.createElement('style');
            hideUIStyle.id = 'hideUIStyle';
            hideUIStyle.textContent = `
                /* Hide scrollbars */
                ::-webkit-scrollbar { display: none !important; }
                html { -ms-overflow-style: none !important; scrollbar-width: none !important; }
                
                /* Prevent text selection outside iframe */
                body { -webkit-user-select: none !important; -moz-user-select: none !important; -ms-user-select: none !important; user-select: none !important; }
                
                /* Hide any browser UI that might show */
                body { margin: 0 !important; padding: 0 !important; overflow: hidden !important; }
                
                /* Force fullscreen appearance */
                html, body { width: 100vw !important; height: 100vh !important; }
            `;
            document.head.appendChild(hideUIStyle);
        }
        
        function showBrowserUI() {
            const hideUIStyle = document.getElementById('hideUIStyle');
            if (hideUIStyle) {
                hideUIStyle.remove();
            }
        }
        
        // Disable browser context menus
        function disableBrowserContextMenus() {
            // Disable right-click on all elements
            document.addEventListener('contextmenu', preventRightClick, true);
            
            // Disable drag and drop
            document.addEventListener('dragstart', preventDefaultAction, true);
            document.addEventListener('drop', preventDefaultAction, true);
            document.addEventListener('dragover', preventDefaultAction, true);
            
            // Disable text selection
            document.addEventListener('selectstart', preventDefaultAction, true);
        }
        
        function enableBrowserContextMenus() {
            document.removeEventListener('contextmenu', preventRightClick, true);
            document.removeEventListener('dragstart', preventDefaultAction, true);
            document.removeEventListener('drop', preventDefaultAction, true);
            document.removeEventListener('dragover', preventDefaultAction, true);
            document.removeEventListener('selectstart', preventDefaultAction, true);
        }
        
        function preventRightClick(e) {
            e.preventDefault();
            e.stopPropagation();
            showRightClickWarning();
            return false;
        }
        
        // Monitor window state changes
        let windowStateMonitor;
        
        function monitorWindowState() {
            windowStateMonitor = setInterval(() => {
                if (isExamActive) {
                    // Check if window is minimized or not focused
                    if (document.hidden || !document.hasFocus()) {
                        securityViolations++;
                        showWindowStateWarning();
                        
                        if (securityViolations >= MAX_VIOLATIONS) {
                            terminateExamForViolation();
                        } else {
                            showViolationWarning();
                        }
                        
                        // Try to bring window back to focus
                        window.focus();
                        requestFullscreen();
                    }
                }
            }, 500);
        }
        
        function stopMonitoringWindowState() {
            if (windowStateMonitor) {
                clearInterval(windowStateMonitor);
                windowStateMonitor = null;
            }
        }
        
        // Prevent window minimize/maximize controls
        function preventWindowControls() {
            // Override window methods that could be used to control window
            const originalOpen = window.open;
            window.open = function() {
                showWindowControlWarning();
                return null;
            };
            
            const originalClose = window.close;
            window.close = function() {
                showWindowControlWarning();
                return false;
            };
            
            // Prevent window resizing
            window.addEventListener('resize', handleWindowResize);
        }
        
        function allowWindowControls() {
            // Restore original window methods (if we stored them)
            // This is a simplified restoration
            window.removeEventListener('resize', handleWindowResize);
        }
        
        function handleWindowResize() {
            if (isExamActive) {
                // Force back to fullscreen if window is resized
                setTimeout(() => {
                    requestFullscreen();
                }, 100);
            }
        }
        
        function restoreNormalMode() {
            // Exit fullscreen
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }
        
        // ===== DESKTOP WARNING FUNCTIONS =====
        
        function showEscapeKeyWarning() {
            showKeyboardWarning('ESC', 'Tombol ESC diblokir selama ujian!');
        }
        
        function showF11Warning() {
            showKeyboardWarning('F11', 'Tombol F11 diblokir! Mode fullscreen wajib!');
        }
        
        function showAltF4Warning() {
            showKeyboardWarning('Alt+F4', 'Alt+F4 diblokir! Tidak bisa tutup aplikasi!');
        }
        
        function showAltTabWarning() {
            showKeyboardWarning('Alt+Tab', 'Alt+Tab diblokir! Tidak bisa ganti aplikasi!');
        }
        
        function showCtrlTabWarning() {
            showKeyboardWarning('Ctrl+Tab', 'Ctrl+Tab diblokir! Tidak bisa ganti tab!');
        }
        
        function showWindowsKeyWarning() {
            showKeyboardWarning('Windows Key', 'Tombol Windows diblokir selama ujian!');
        }
        
        function showDevToolsWarning() {
            showKeyboardWarning('Developer Tools', 'Developer Tools diblokir selama ujian!');
        }
        
        function showViewSourceWarning() {
            showKeyboardWarning('Ctrl+U', 'View Source diblokir selama ujian!');
        }
        
        function showInspectWarning() {
            showKeyboardWarning('Ctrl+Shift+C', 'Inspect Element diblokir selama ujian!');
        }
        
        function showNewWindowWarning() {
            showKeyboardWarning('Ctrl+N', 'New Window diblokir selama ujian!');
        }
        
        function showNewTabWarning() {
            showKeyboardWarning('Ctrl+T', 'New Tab diblokir selama ujian!');
        }
        
        function showCloseTabWarning() {
            showKeyboardWarning('Ctrl+W', 'Close Tab diblokir selama ujian!');
        }
        
        function showRefreshWarning() {
            showKeyboardWarning('Refresh', 'Refresh diblokir selama ujian!');
        }
        
        function showIncognitoWarning() {
            showKeyboardWarning('Ctrl+Shift+N', 'Incognito Window diblokir selama ujian!');
        }
        
        function showReopenTabWarning() {
            showKeyboardWarning('Ctrl+Shift+T', 'Reopen Tab diblokir selama ujian!');
        }
        
        function showAddressBarWarning() {
            showKeyboardWarning('Ctrl+L', 'Address Bar diblokir selama ujian!');
        }
        
        function showBookmarkWarning() {
            showKeyboardWarning('Ctrl+D', 'Bookmark diblokir selama ujian!');
        }
        
        function showHistoryWarning() {
            showKeyboardWarning('Ctrl+H', 'History diblokir selama ujian!');
        }
        
        function showDownloadsWarning() {
            showKeyboardWarning('Ctrl+J', 'Downloads diblokir selama ujian!');
        }
        
        function showClearDataWarning() {
            showKeyboardWarning('Ctrl+Shift+Del', 'Clear Data diblokir selama ujian!');
        }
        
        function showPrintScreenWarning() {
            showKeyboardWarning('Print Screen', 'Screenshot diblokir selama ujian!');
        }
        
        function showPrintWarning() {
            showKeyboardWarning('Ctrl+P', 'Print diblokir selama ujian!');
        }
        
        function showSaveWarning() {
            showKeyboardWarning('Ctrl+S', 'Save diblokir selama ujian!');
        }
        
        function showOpenFileWarning() {
            showKeyboardWarning('Ctrl+O', 'Open File diblokir selama ujian!');
        }
        
        function showFindWarning() {
            showKeyboardWarning('Ctrl+F', 'Find diblokir selama ujian!');
        }
        
        function showFunctionKeyWarning(key) {
            showKeyboardWarning(key, `Tombol ${key} diblokir selama ujian!`);
        }
        
        function showRightClickWarning() {
            showKeyboardWarning('Right Click', 'Klik kanan diblokir selama ujian!');
        }
        
        function showWindowControlWarning() {
            showKeyboardWarning('Window Control', 'Kontrol window diblokir selama ujian!');
        }
        
        function showWindowStateWarning() {
            showKeyboardWarning('Window State', 'Jangan minimize atau ganti aplikasi!');
        }
        
        function showFullscreenForceWarning() {
            showKeyboardWarning('Fullscreen', 'Mode fullscreen dipaksa aktif!');
        }
        
        // Generic keyboard warning function
        function showKeyboardWarning(keyName, message) {
            // Remove existing warning first
            const existingWarning = document.getElementById('keyboardWarning');
            if (existingWarning) {
                existingWarning.remove();
            }
            
            const warningDiv = document.createElement('div');
            warningDiv.id = 'keyboardWarning';
            warningDiv.className = 'fixed top-0 left-0 right-0 bg-red-600 text-white text-center py-2 z-50 font-bold text-sm animate-pulse';
            warningDiv.innerHTML = `⚠️ ${keyName}: ${message}`;
            document.body.appendChild(warningDiv);
            
            // Auto hide after 2 seconds
            setTimeout(() => {
                if (warningDiv && warningDiv.parentNode) {
                    warningDiv.remove();
                }
            }, 2000);
        }

        // ===== MOBILE SECURITY FUNCTIONS =====
        
        // Block all mobile hardware buttons during exam
        function enableMobileHardwareBlock() {
            if (!isMobileDevice()) return;
            
            // Block volume buttons
            document.addEventListener('volumeupbutton', preventDefaultAction, false);
            document.addEventListener('volumedownbutton', preventDefaultAction, false);
            
            // Block power button (if possible)
            document.addEventListener('pause', handleAppPause, false);
            document.addEventListener('resume', handleAppResume, false);
            
            // Block menu button
            document.addEventListener('menubutton', preventDefaultAction, false);
            
            // Block search button
            document.addEventListener('searchbutton', preventDefaultAction, false);
            
            // Block camera button
            document.addEventListener('startcallbutton', preventDefaultAction, false);
            document.addEventListener('endcallbutton', preventDefaultAction, false);
        }
        
        function disableMobileHardwareBlock() {
            if (!isMobileDevice()) return;
            
            document.removeEventListener('volumeupbutton', preventDefaultAction, false);
            document.removeEventListener('volumedownbutton', preventDefaultAction, false);
            document.removeEventListener('pause', handleAppPause, false);
            document.removeEventListener('resume', handleAppResume, false);
            document.removeEventListener('menubutton', preventDefaultAction, false);
            document.removeEventListener('searchbutton', preventDefaultAction, false);
            document.removeEventListener('startcallbutton', preventDefaultAction, false);
            document.removeEventListener('endcallbutton', preventDefaultAction, false);
        }
        
        // Handle app pause (when user tries to switch apps)
        function handleAppPause() {
            if (isExamActive) {
                securityViolations++;
                showAppSwitchWarning();
                
                if (securityViolations >= MAX_VIOLATIONS) {
                    terminateExamForViolation();
                } else {
                    showViolationWarning();
                }
            }
        }
        
        // Handle app resume
        function handleAppResume() {
            if (isExamActive && securityViolations < MAX_VIOLATIONS) {
                hideAppSwitchWarning();
                hideViolationWarning();
                
                // Force back to fullscreen
                requestFullscreen();
            }
        }
        
        // Block navigation gestures
        function enableNavigationBlock() {
            if (!isMobileDevice()) return;
            
            // Prevent swipe gestures
            document.addEventListener('touchstart', blockNavigationGestures, { passive: false });
            document.addEventListener('touchmove', blockNavigationGestures, { passive: false });
            document.addEventListener('touchend', blockNavigationGestures, { passive: false });
            
            // Prevent mouse events that could trigger navigation
            document.addEventListener('mousedown', blockNavigationGestures, { passive: false });
            document.addEventListener('mousemove', blockNavigationGestures, { passive: false });
            document.addEventListener('mouseup', blockNavigationGestures, { passive: false });
        }
        
        function disableNavigationBlock() {
            if (!isMobileDevice()) return;
            
            document.removeEventListener('touchstart', blockNavigationGestures, { passive: false });
            document.removeEventListener('touchmove', blockNavigationGestures, { passive: false });
            document.removeEventListener('touchend', blockNavigationGestures, { passive: false });
            document.removeEventListener('mousedown', blockNavigationGestures, { passive: false });
            document.removeEventListener('mousemove', blockNavigationGestures, { passive: false });
            document.removeEventListener('mouseup', blockNavigationGestures, { passive: false });
        }
        
        // Block navigation gestures (swipe from edges)
        function blockNavigationGestures(e) {
            if (!isExamActive) return;
            
            const touch = e.touches ? e.touches[0] : e;
            const x = touch.clientX;
            const y = touch.clientY;
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            // Block swipe from left edge (back gesture)
            if (x < 50) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
            
            // Block swipe from right edge (forward gesture)
            if (x > screenWidth - 50) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
            
            // Block swipe from top edge (pull down notifications)
            if (y < 50) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
            
            // Block swipe from bottom edge (home gesture)
            if (y > screenHeight - 100) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        }
        
        // Lock screen orientation
        function lockScreenOrientation() {
            if (!isMobileDevice()) return;
            
            try {
                // Try to lock to current orientation
                if (screen.orientation && screen.orientation.lock) {
                    screen.orientation.lock('portrait-primary').catch(() => {
                        // Fallback: try to lock to any portrait
                        screen.orientation.lock('portrait').catch(() => {
                            console.log('Screen orientation lock not supported');
                        });
                    });
                }
                // Legacy method
                else if (screen.lockOrientation) {
                    screen.lockOrientation('portrait');
                }
                // WebKit method
                else if (screen.webkitLockOrientation) {
                    screen.webkitLockOrientation('portrait');
                }
                // Mozilla method
                else if (screen.mozLockOrientation) {
                    screen.mozLockOrientation('portrait');
                }
            } catch (error) {
                console.log('Orientation lock failed:', error);
            }
        }
        
        function unlockScreenOrientation() {
            if (!isMobileDevice()) return;
            
            try {
                if (screen.orientation && screen.orientation.unlock) {
                    screen.orientation.unlock();
                }
                else if (screen.unlockOrientation) {
                    screen.unlockOrientation();
                }
                else if (screen.webkitUnlockOrientation) {
                    screen.webkitUnlockOrientation();
                }
                else if (screen.mozUnlockOrientation) {
                    screen.mozUnlockOrientation();
                }
            } catch (error) {
                console.log('Orientation unlock failed:', error);
            }
        }
        
        // Disable pull-to-refresh
        function disablePullToRefresh() {
            if (!isMobileDevice()) return;
            
            document.body.style.overscrollBehavior = 'none';
            document.documentElement.style.overscrollBehavior = 'none';
            
            // Additional prevention
            let startY = 0;
            
            document.addEventListener('touchstart', function(e) {
                if (!isExamActive) return;
                startY = e.touches[0].clientY;
            }, { passive: false });
            
            document.addEventListener('touchmove', function(e) {
                if (!isExamActive) return;
                
                const currentY = e.touches[0].clientY;
                const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                
                // Prevent pull-to-refresh when at top of page
                if (scrollTop === 0 && currentY > startY) {
                    e.preventDefault();
                }
            }, { passive: false });
        }
        
        function enablePullToRefresh() {
            if (!isMobileDevice()) return;
            
            document.body.style.overscrollBehavior = 'auto';
            document.documentElement.style.overscrollBehavior = 'auto';
        }
        
        // Block Android back button
        function blockAndroidBackButton() {
            if (!isMobileDevice()) return;
            
            // Override browser back button
            history.pushState(null, null, location.href);
            window.addEventListener('popstate', handleBackButton);
            
            // Cordova/PhoneGap back button (if available)
            document.addEventListener('backbutton', handleBackButton, false);
        }
        
        function unblockAndroidBackButton() {
            if (!isMobileDevice()) return;
            
            window.removeEventListener('popstate', handleBackButton);
            document.removeEventListener('backbutton', handleBackButton, false);
        }
        
        // Handle back button press
        function handleBackButton(e) {
            if (isExamActive) {
                e.preventDefault();
                e.stopPropagation();
                
                // Push state again to prevent navigation
                history.pushState(null, null, location.href);
                
                // Show warning
                showBackButtonWarning();
                
                // Count as violation
                securityViolations++;
                if (securityViolations >= MAX_VIOLATIONS) {
                    terminateExamForViolation();
                } else {
                    showViolationWarning();
                }
                
                return false;
            }
        }
        
        // Prevent app switching
        function preventAppSwitching() {
            if (!isMobileDevice()) return;
            
            // Monitor page visibility more aggressively
            let visibilityTimer;
            
            document.addEventListener('visibilitychange', function() {
                if (document.hidden && isExamActive) {
                    // User switched apps or minimized
                    securityViolations++;
                    showAppSwitchWarning();
                    
                    if (securityViolations >= MAX_VIOLATIONS) {
                        terminateExamForViolation();
                    } else {
                        showViolationWarning();
                    }
                    
                    // Try to bring app back to foreground
                    visibilityTimer = setTimeout(() => {
                        if (document.hidden && isExamActive) {
                            // Force focus back
                            window.focus();
                            requestFullscreen();
                        }
                    }, 1000);
                } else if (!document.hidden && isExamActive) {
                    clearTimeout(visibilityTimer);
                    hideAppSwitchWarning();
                    if (securityViolations < MAX_VIOLATIONS) {
                        hideViolationWarning();
                    }
                }
            });
            
            // Monitor window focus more aggressively
            window.addEventListener('blur', function() {
                if (isExamActive) {
                    setTimeout(() => {
                        window.focus();
                        requestFullscreen();
                    }, 100);
                }
            });
        }
        
        function allowAppSwitching() {
            // This function exists for consistency but doesn't need to do anything
            // as the event listeners are already removed in disableExamSecurity
        }

        // Prevent default actions
        function preventDefaultAction(e) {
            e.preventDefault();
            return false;
        }

        // Handle keyboard shortcuts during exam
        function handleExamKeydown(e) {
            // Disable ESC key (exit fullscreen)
            if (e.key === 'Escape') {
                e.preventDefault();
                showEscapeKeyWarning();
                return false;
            }
            
            // Disable F11 (fullscreen toggle)
            if (e.key === 'F11') {
                e.preventDefault();
                showF11Warning();
                return false;
            }
            
            // Disable Alt+F4 (close window)
            if (e.altKey && e.key === 'F4') {
                e.preventDefault();
                showAltF4Warning();
                return false;
            }
            
            // Disable Alt+Tab (window switching)
            if (e.altKey && e.key === 'Tab') {
                e.preventDefault();
                showAltTabWarning();
                return false;
            }
            
            // Disable Ctrl+Tab (tab switching)
            if (e.ctrlKey && e.key === 'Tab') {
                e.preventDefault();
                showCtrlTabWarning();
                return false;
            }
            
            // Disable Windows key combinations
            if (e.key === 'Meta' || e.metaKey) {
                e.preventDefault();
                showWindowsKeyWarning();
                return false;
            }
            
            // Disable Ctrl+Shift+I (Developer Tools)
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                showDevToolsWarning();
                return false;
            }
            
            // Disable F12 (Developer Tools)
            if (e.key === 'F12') {
                e.preventDefault();
                showDevToolsWarning();
                return false;
            }
            
            // Disable Ctrl+U (View Source)
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                showViewSourceWarning();
                return false;
            }
            
            // Disable Ctrl+Shift+C (Inspect Element)
            if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                e.preventDefault();
                showInspectWarning();
                return false;
            }
            
            // Disable Ctrl+N (New Window)
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                showNewWindowWarning();
                return false;
            }
            
            // Disable Ctrl+T (New Tab)
            if (e.ctrlKey && e.key === 't') {
                e.preventDefault();
                showNewTabWarning();
                return false;
            }
            
            // Disable Ctrl+W (Close Tab)
            if (e.ctrlKey && e.key === 'w') {
                e.preventDefault();
                showCloseTabWarning();
                return false;
            }
            
            // Disable Ctrl+R (Refresh)
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                showRefreshWarning();
                return false;
            }
            
            // Disable Ctrl+F5 (Hard Refresh)
            if (e.ctrlKey && e.key === 'F5') {
                e.preventDefault();
                showRefreshWarning();
                return false;
            }
            
            // Disable F5 (Refresh)
            if (e.key === 'F5') {
                e.preventDefault();
                showRefreshWarning();
                return false;
            }
            
            // Disable Ctrl+Shift+N (Incognito Window)
            if (e.ctrlKey && e.shiftKey && e.key === 'N') {
                e.preventDefault();
                showIncognitoWarning();
                return false;
            }
            
            // Disable Ctrl+Shift+T (Reopen Closed Tab)
            if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                e.preventDefault();
                showReopenTabWarning();
                return false;
            }
            
            // Disable Ctrl+L (Address Bar)
            if (e.ctrlKey && e.key === 'l') {
                e.preventDefault();
                showAddressBarWarning();
                return false;
            }
            
            // Disable Ctrl+D (Bookmark)
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                showBookmarkWarning();
                return false;
            }
            
            // Disable Ctrl+H (History)
            if (e.ctrlKey && e.key === 'h') {
                e.preventDefault();
                showHistoryWarning();
                return false;
            }
            
            // Disable Ctrl+J (Downloads)
            if (e.ctrlKey && e.key === 'j') {
                e.preventDefault();
                showDownloadsWarning();
                return false;
            }
            
            // Disable Ctrl+Shift+Delete (Clear Browsing Data)
            if (e.ctrlKey && e.shiftKey && e.key === 'Delete') {
                e.preventDefault();
                showClearDataWarning();
                return false;
            }
            
            // Disable Print Screen
            if (e.key === 'PrintScreen') {
                e.preventDefault();
                showPrintScreenWarning();
                return false;
            }
            
            // Disable Ctrl+P (Print)
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                showPrintWarning();
                return false;
            }
            
            // Disable Ctrl+S (Save)
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                showSaveWarning();
                return false;
            }
            
            // Disable Ctrl+O (Open File)
            if (e.ctrlKey && e.key === 'o') {
                e.preventDefault();
                showOpenFileWarning();
                return false;
            }
            
            // Disable Ctrl+F (Find)
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                showFindWarning();
                return false;
            }
            
            // Disable Ctrl+G (Find Next)
            if (e.ctrlKey && e.key === 'g') {
                e.preventDefault();
                showFindWarning();
                return false;
            }
            
            // Disable all function keys F1-F12
            if (e.key.startsWith('F') && e.key.length <= 3) {
                const fKeyNumber = parseInt(e.key.substring(1));
                if (fKeyNumber >= 1 && fKeyNumber <= 12) {
                    e.preventDefault();
                    showFunctionKeyWarning(e.key);
                    return false;
                }
            }
        }

        // Handle fullscreen changes
        function handleFullscreenChange() {
            if (!document.fullscreenElement && 
                !document.webkitFullscreenElement && 
                !document.mozFullScreenElement && 
                !document.msFullscreenElement) {
                
                if (isExamActive) {
                    // Show warning if user exits fullscreen during exam
                    showFullscreenWarning();
                }
            }
        }

        // Security violation tracking
        let securityViolations = 0;
        const MAX_VIOLATIONS = 2; // Maximum allowed violations before exam termination
        let violationTimer = null;

        // Handle window blur (losing focus)
        function handleWindowBlur() {
            if (isExamActive) {
                securityViolations++;
                showFocusWarning();
                
                if (securityViolations >= MAX_VIOLATIONS) {
                    terminateExamForViolation();
                } else {
                    showViolationWarning();
                }
            }
        }

        // Handle window focus (gaining focus back)
        function handleWindowFocus() {
            if (isExamActive && securityViolations < MAX_VIOLATIONS) {
                hideFocusWarning();
                hideViolationWarning();
            }
        }

        // Handle visibility changes (tab switching)
        function handleVisibilityChange() {
            if (document.hidden && isExamActive) {
                securityViolations++;
                showTabSwitchWarning();
                
                if (securityViolations >= MAX_VIOLATIONS) {
                    terminateExamForViolation();
                } else {
                    showViolationWarning();
                }
            } else if (!document.hidden && isExamActive && securityViolations < MAX_VIOLATIONS) {
                hideTabSwitchWarning();
                hideViolationWarning();
            }
        }

        // Show fullscreen warning
        function showFullscreenWarning() {
            const warningDiv = document.createElement('div');
            warningDiv.id = 'fullscreenWarning';
            warningDiv.className = 'fixed inset-0 bg-red-600 bg-opacity-95 flex items-center justify-center z-50';
            warningDiv.innerHTML = `
                <div class="text-center text-white p-8">
                    <div class="text-6xl mb-4">⚠️</div>
                    <h2 class="text-3xl font-bold mb-4">PERINGATAN!</h2>
                    <p class="text-xl mb-6">Anda keluar dari mode fullscreen!</p>
                    <p class="text-lg mb-8">Klik tombol di bawah untuk kembali ke mode fullscreen</p>
                    <button onclick="returnToFullscreen()" class="bg-white text-red-600 px-8 py-4 rounded-lg hover:bg-gray-100 transition duration-200 font-bold text-lg">
                        Kembali ke Fullscreen
                    </button>
                </div>
            `;
            document.body.appendChild(warningDiv);
        }

        // Show focus warning
        function showFocusWarning() {
            let focusWarning = document.getElementById('focusWarning');
            if (!focusWarning) {
                focusWarning = document.createElement('div');
                focusWarning.id = 'focusWarning';
                focusWarning.className = 'fixed top-0 left-0 right-0 bg-orange-600 text-white text-center py-3 z-40 font-bold';
                focusWarning.innerHTML = '⚠️ PERINGATAN: Jangan beralih ke aplikasi lain! Fokus pada ujian!';
                document.body.appendChild(focusWarning);
            }
        }

        // Hide focus warning
        function hideFocusWarning() {
            const focusWarning = document.getElementById('focusWarning');
            if (focusWarning) {
                focusWarning.remove();
            }
        }

        // Show tab switch warning
        function showTabSwitchWarning() {
            let tabWarning = document.getElementById('tabWarning');
            if (!tabWarning) {
                tabWarning = document.createElement('div');
                tabWarning.id = 'tabWarning';
                tabWarning.className = 'fixed top-0 left-0 right-0 bg-red-600 text-white text-center py-3 z-40 font-bold animate-pulse';
                tabWarning.innerHTML = '🚫 PERINGATAN: Jangan berpindah tab! Kembali ke ujian sekarang!';
                document.body.appendChild(tabWarning);
            }
        }
        
        // Show app switch warning
        function showAppSwitchWarning() {
            let appWarning = document.getElementById('appWarning');
            if (!appWarning) {
                appWarning = document.createElement('div');
                appWarning.id = 'appWarning';
                appWarning.className = 'fixed top-0 left-0 right-0 bg-red-700 text-white text-center py-3 z-40 font-bold animate-pulse';
                appWarning.innerHTML = '🚫 PERINGATAN: Jangan buka aplikasi lain! Fokus pada ujian!';
                document.body.appendChild(appWarning);
            }
        }
        
        // Hide app switch warning
        function hideAppSwitchWarning() {
            const appWarning = document.getElementById('appWarning');
            if (appWarning) {
                appWarning.remove();
            }
        }
        
        // Show back button warning
        function showBackButtonWarning() {
            let backWarning = document.getElementById('backWarning');
            if (!backWarning) {
                backWarning = document.createElement('div');
                backWarning.id = 'backWarning';
                backWarning.className = 'fixed top-0 left-0 right-0 bg-orange-600 text-white text-center py-3 z-40 font-bold animate-pulse';
                backWarning.innerHTML = '⚠️ PERINGATAN: Tombol BACK diblokir selama ujian!';
                document.body.appendChild(backWarning);
                
                // Auto hide after 3 seconds
                setTimeout(() => {
                    if (backWarning) {
                        backWarning.remove();
                    }
                }, 3000);
            }
        }

        // Hide tab switch warning
        function hideTabSwitchWarning() {
            const tabWarning = document.getElementById('tabWarning');
            if (tabWarning) {
                tabWarning.remove();
            }
        }

        // Show violation warning
        function showViolationWarning() {
            let violationWarning = document.getElementById('violationWarning');
            if (!violationWarning) {
                violationWarning = document.createElement('div');
                violationWarning.id = 'violationWarning';
                violationWarning.className = 'fixed inset-0 bg-red-600 bg-opacity-95 flex items-center justify-center z-50';
                
                const remainingViolations = MAX_VIOLATIONS - securityViolations;
                
                violationWarning.innerHTML = `
                    <div class="text-center text-white p-8 max-w-md">
                        <div class="text-6xl mb-4">🚨</div>
                        <h2 class="text-3xl font-bold mb-4">PELANGGARAN KEAMANAN!</h2>
                        <p class="text-xl mb-4">Anda telah melanggar aturan ujian!</p>
                        <div class="bg-red-700 rounded-lg p-4 mb-6">
                            <p class="text-lg font-bold">Pelanggaran ke-${securityViolations} dari ${MAX_VIOLATIONS}</p>
                            <p class="text-sm mt-2">Sisa kesempatan: ${remainingViolations}</p>
                        </div>
                        <p class="text-lg mb-6">
                            ${remainingViolations > 0 
                                ? `Jika melanggar lagi, ujian akan BERAKHIR OTOMATIS!` 
                                : `Ujian akan berakhir sekarang!`}
                        </p>
                        <div class="text-sm text-red-200">
                            <p>• Jangan buka aplikasi lain</p>
                            <p>• Jangan pindah tab browser</p>
                            <p>• Fokus pada ujian saja</p>
                        </div>
                    </div>
                `;
                document.body.appendChild(violationWarning);
                
                // Auto hide after 5 seconds if not terminated
                if (remainingViolations > 0) {
                    violationTimer = setTimeout(() => {
                        hideViolationWarning();
                    }, 5000);
                }
            }
        }

        // Hide violation warning
        function hideViolationWarning() {
            const violationWarning = document.getElementById('violationWarning');
            if (violationWarning) {
                violationWarning.remove();
            }
            if (violationTimer) {
                clearTimeout(violationTimer);
                violationTimer = null;
            }
        }

        // Terminate exam for security violation
        function terminateExamForViolation() {
            if (examTimer) {
                clearInterval(examTimer);
            }
            
            // Mark exam as completed (blocked) to prevent retaking
            markExamCompleted(currentStudent.key, currentExamSubject.id);
            
            // Show termination message
            showExamTerminationMessage();
        }

        // Show exam termination message
        function showExamTerminationMessage() {
            const terminationOverlay = document.createElement('div');
            terminationOverlay.className = 'fixed inset-0 bg-red-800 bg-opacity-95 flex items-center justify-center z-50';
            terminationOverlay.innerHTML = `
                <div class="text-center text-white p-8 max-w-lg">
                    <div class="text-8xl mb-6">❌</div>
                    <h2 class="text-4xl font-bold mb-6">UJIAN DIHENTIKAN!</h2>
                    <div class="bg-red-900 rounded-lg p-6 mb-6">
                        <p class="text-xl font-bold mb-4">Alasan: Pelanggaran Keamanan</p>
                        <p class="text-lg mb-2">Anda telah melanggar aturan ujian sebanyak ${securityViolations} kali</p>
                        <p class="text-base">• Membuka aplikasi lain</p>
                        <p class="text-base">• Berpindah tab browser</p>
                    </div>
                    <div class="bg-yellow-600 rounded-lg p-4 mb-6">
                        <p class="text-lg font-bold mb-2">⚠️ PENTING!</p>
                        <p class="text-sm">Ujian ini sudah TIDAK DAPAT DIULANG dengan akun Google yang sama.</p>
                        <p class="text-sm">Hubungi guru untuk instruksi lebih lanjut.</p>
                    </div>
                    <button onclick="exitExamAfterTermination()" class="bg-white text-red-800 px-8 py-4 rounded-lg hover:bg-gray-100 transition duration-200 font-bold text-lg">
                        Kembali ke Dashboard
                    </button>
                </div>
            `;
            document.body.appendChild(terminationOverlay);
        }

        // Return to fullscreen
        function returnToFullscreen() {
            const warning = document.getElementById('fullscreenWarning');
            if (warning) {
                warning.remove();
            }
            requestFullscreen();
        }

        // Make functions globally accessible
        window.returnToFullscreen = returnToFullscreen;

        // Start exam timer
        function startExamTimer() {
            timeRemaining = 90 * 60; // Reset to 90 minutes
            
            examTimer = setInterval(function() {
                timeRemaining--;
                
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                const timeDisplay = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                document.getElementById('timeLeft').textContent = timeDisplay;
                
                // Warning when less than 10 minutes
                if (timeRemaining <= 600) {
                    document.getElementById('timerOverlay').classList.add('timer-warning');
                }
                
                // Time's up
                if (timeRemaining <= 0) {
                    clearInterval(examTimer);
                    showTimeUpMessage();
                }
            }, 1000);
        }

        // Show time's up message
        function showTimeUpMessage() {
            const timeUpOverlay = document.createElement('div');
            timeUpOverlay.className = 'fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50';
            timeUpOverlay.innerHTML = `
                <div class="text-center text-white p-8">
                    <div class="text-6xl mb-4">⏰</div>
                    <h2 class="text-2xl font-bold mb-4">WAKTU UJIAN HABIS!</h2>
                    <p class="text-lg mb-6">Pastikan Anda telah mengirim jawaban di Google Form</p>
                    <button onclick="exitExam()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition duration-200">
                        Keluar dari Ujian
                    </button>
                </div>
            `;
            document.body.appendChild(timeUpOverlay);
        }

        // Exit exam function
        function exitExam() {
            if (examTimer) {
                clearInterval(examTimer);
            }
            
            isExamActive = false;
            
            // Exit fullscreen mode
            exitFullscreen();
            
            // Disable exam security measures
            disableExamSecurity();
            
            // Remove mobile security classes
            document.body.classList.remove('exam-active');
            document.documentElement.classList.remove('exam-active');
            document.getElementById('examContainer').classList.remove('exam-locked');
            
            // Show dashboard and hide exam container
            document.getElementById('examContainer').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            
            // Clear iframe
            document.getElementById('examIframe').src = '';
            
            // Restore body scrolling
            document.body.style.overflow = 'auto';
            
            // Remove timer warning class
            document.getElementById('timerOverlay').classList.remove('timer-warning');
            
            // Remove any warning overlays
            const timeUpOverlay = document.querySelector('.fixed.inset-0.bg-black.bg-opacity-90');
            if (timeUpOverlay) {
                timeUpOverlay.remove();
            }
            
            const fullscreenWarning = document.getElementById('fullscreenWarning');
            if (fullscreenWarning) {
                fullscreenWarning.remove();
            }
            
            const focusWarning = document.getElementById('focusWarning');
            if (focusWarning) {
                focusWarning.remove();
            }
            
            const tabWarning = document.getElementById('tabWarning');
            if (tabWarning) {
                tabWarning.remove();
            }
            
            const appWarning = document.getElementById('appWarning');
            if (appWarning) {
                appWarning.remove();
            }
            
            const backWarning = document.getElementById('backWarning');
            if (backWarning) {
                backWarning.remove();
            }
        }

        // Exit exam after termination
        function exitExamAfterTermination() {
            if (examTimer) {
                clearInterval(examTimer);
            }
            
            isExamActive = false;
            securityViolations = 0;
            
            // Exit fullscreen mode
            exitFullscreen();
            
            // Disable exam security measures
            disableExamSecurity();
            
            // Remove mobile security classes
            document.body.classList.remove('exam-active');
            document.documentElement.classList.remove('exam-active');
            document.getElementById('examContainer').classList.remove('exam-locked');
            
            // Show dashboard and hide exam container
            document.getElementById('examContainer').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            
            // Clear iframe
            document.getElementById('examIframe').src = '';
            
            // Restore body scrolling
            document.body.style.overflow = 'auto';
            
            // Remove timer warning class
            document.getElementById('timerOverlay').classList.remove('timer-warning');
            
            // Remove all warning overlays
            const overlays = [
                '.fixed.inset-0.bg-red-800.bg-opacity-95',
                '.fixed.inset-0.bg-red-600.bg-opacity-95',
                '.fixed.inset-0.bg-black.bg-opacity-90',
                '#fullscreenWarning',
                '#focusWarning',
                '#tabWarning',
                '#appWarning',
                '#backWarning',
                '#violationWarning'
            ];
            
            overlays.forEach(selector => {
                const element = document.querySelector(selector) || document.getElementById(selector.replace('#', ''));
                if (element) {
                    element.remove();
                }
            });
            
            // Refresh subjects to show updated status
            renderSubjects();
        }

        // Make functions globally accessible
        window.exitExam = exitExam;
        window.exitExamAfterTermination = exitExamAfterTermination;

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (isExamActive) {
                const confirmLogout = document.createElement('div');
                confirmLogout.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
                confirmLogout.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                        <div class="text-center">
                            <div class="bg-red-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-red-600 text-2xl">⚠️</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Konfirmasi Logout</h3>
                            <p class="text-gray-600 mb-6">Anda sedang dalam ujian. Yakin ingin logout? Timer akan berhenti dan ujian akan berakhir.</p>
                            
                            <div class="flex space-x-4">
                                <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove()" 
                                        class="flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 transition duration-200">
                                    Batal
                                </button>
                                <button onclick="confirmLogoutAction()" 
                                        class="flex-1 bg-red-600 text-white py-3 px-4 rounded-lg hover:bg-red-700 transition duration-200">
                                    Ya, Logout
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(confirmLogout);
            } else {
                performLogout();
            }
        });

        function confirmLogoutAction() {
            document.querySelector('.fixed.inset-0.bg-black.bg-opacity-50').remove();
            performLogout();
        }

        function performLogout() {
            if (examTimer) {
                clearInterval(examTimer);
            }
            
            exitExam();
            
            currentStudent = null;
            
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            
            // Reset form
            document.getElementById('loginForm').reset();
            document.getElementById('studentClass').disabled = true;
        }

        // Make confirmLogoutAction globally accessible
        window.confirmLogoutAction = confirmLogoutAction;

        // PWA Install Event Listeners
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show install button and notification
            showInstallOptions();
        });

        window.addEventListener('appinstalled', () => {
            // Hide install options after successful installation
            hideInstallOptions();
            showInstallSuccessMessage();
            deferredPrompt = null;
        });

        // Check if app is already installed (standalone mode)
        function isAppInstalled() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }

        // Show install options
        function showInstallOptions() {
            // Always show install button since this is meant to be an app
            const installBtn = document.getElementById('installBtn');
            if (installBtn) {
                installBtn.classList.remove('hidden');
            }
            
            // Always show install notification on login page
            const loginPage = document.getElementById('loginPage');
            if (!loginPage.classList.contains('hidden')) {
                document.getElementById('loginInstallNotification').classList.remove('hidden');
            }
        }

        // Hide install options
        function hideInstallOptions() {
            // Only hide the notification, keep the install button visible
            const loginInstallNotification = document.getElementById('loginInstallNotification');
            if (loginInstallNotification) {
                loginInstallNotification.classList.add('hidden');
            }
            
            const installModal = document.getElementById('installModal');
            if (installModal) {
                installModal.classList.add('hidden');
            }
        }

        // Show install success message
        function showInstallSuccessMessage() {
            const successMessage = document.createElement('div');
            successMessage.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-pulse';
            successMessage.innerHTML = '✅ Aplikasi Portal Ujian sudah terinstall!';
            document.body.appendChild(successMessage);
            
            setTimeout(() => {
                successMessage.remove();
            }, 4000);
        }

        // Install button click handlers
        document.getElementById('installBtn').addEventListener('click', showInstallModal);
        document.getElementById('loginInstallBtn').addEventListener('click', showInstallModal);

        // Show install modal
        function showInstallModal() {
            document.getElementById('installModal').classList.remove('hidden');
        }

        // Cancel install
        document.getElementById('cancelInstall').addEventListener('click', function() {
            document.getElementById('installModal').classList.add('hidden');
        });

        // Dismiss install notification on login page
        document.getElementById('loginDismissBtn').addEventListener('click', function() {
            document.getElementById('loginInstallNotification').classList.add('hidden');
            isInstallPromptShown = true; // Don't show again this session
        });

        // Confirm install
        document.getElementById('confirmInstall').addEventListener('click', async function() {
            if (deferredPrompt) {
                // Show the install prompt
                deferredPrompt.prompt();
                
                // Wait for the user to respond to the prompt
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                } else {
                    console.log('User dismissed the install prompt');
                }
                
                // Clear the deferredPrompt
                deferredPrompt = null;
                
                // Hide the modal
                document.getElementById('installModal').classList.add('hidden');
            } else {
                // Fallback for browsers that don't support PWA install
                showManualInstallInstructions();
            }
        });

        // Show manual install instructions for unsupported browsers
        function showManualInstallInstructions() {
            const instructionsModal = document.createElement('div');
            instructionsModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            instructionsModal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md">
                    <div class="text-center">
                        <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-blue-600 text-2xl">📱</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Install Manual</h3>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                            <p class="text-blue-800 text-sm font-medium mb-2">📋 CARA INSTALL MANUAL:</p>
                            <ul class="text-blue-700 text-xs space-y-2 text-left">
                                <li><strong>Chrome Android:</strong></li>
                                <li>1️⃣ Klik menu ⋮ di browser</li>
                                <li>2️⃣ Pilih "Tambahkan ke layar utama"</li>
                                <li>3️⃣ Klik "Tambahkan"</li>
                                <br>
                                <li><strong>Samsung Internet:</strong></li>
                                <li>1️⃣ Klik menu ☰ di browser</li>
                                <li>2️⃣ Pilih "Tambahkan halaman ke"</li>
                                <li>3️⃣ Pilih "Layar Utama"</li>
                            </ul>
                        </div>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200">
                            Mengerti
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(instructionsModal);
            
            // Hide install modal
            document.getElementById('installModal').classList.add('hidden');
        }

        // Check for install capability on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Always show install options since this is meant to be an app
            showInstallOptions();
            
            // If app is already installed, show success message
            if (isAppInstalled()) {
                setTimeout(() => {
                    showInstallSuccessMessage();
                }, 1000);
            }
        });

        // Prevent accidental page refresh during exam
        window.addEventListener('beforeunload', function(e) {
            if (isExamActive) {
                e.preventDefault();
                e.returnValue = 'Anda sedang dalam ujian. Yakin ingin meninggalkan halaman?';
            }
        });

        // Handle orientation change on mobile
        window.addEventListener('orientationchange', function() {
            if (isMobileDevice()) {
                setTimeout(function() {
                    // Recalculate viewport height
                    document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
                    
                    // Re-request fullscreen if exam is active
                    if (isExamActive) {
                        requestFullscreen();
                    }
                }, 500);
            }
        });

        // Set initial viewport height for mobile
        if (isMobileDevice()) {
            document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
        }

        // Handle resize events
        window.addEventListener('resize', function() {
            if (isMobileDevice()) {
                document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
            }
        });

        // Prevent zoom on iOS
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });

        // Prevent double-tap zoom
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'990093fae23ea3ee',t:'MTc2MDcxMjMwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
